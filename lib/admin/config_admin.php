<?phpif (!defined('ROOT'))    exit('Can\'t Access !');class config_admin extends admin {    function init() {        //清空缓存---内容商品的        if((front::get('act') == 'system')  && front::post('submit')){            user::deletesession();            category::deletesession();            type::deletesession();            special::deletesession();        }    }        function getcnzz_action(){        $cnzz = new cnzz();        $infos = $cnzz->getinfo();        config::modify(array('cnzz_user' => $infos[0]));        config::modify(array('cnzz_pass' => $infos[1]));        front::redirect(url('config/system/set/cnzz'));    }   //后台切换语言包    function setadminlang_action(){        if(front::get('langurl') != '' ){            //config::modify(array('lang_admin_type' => front::get('langurl')));            lang::setisadmin(front::get('langurl'));        }        /*echo "<script>history.go(-1);</script>";*/        echo '<script>window.location.href="'.url('index/index',true).'";</script>';        exit;    }    function system_action() {        $type=front::get('set');        if ($type == 'security') {            if(session::get('ver') != 'corp'){                front::alert(lang_admin('unauthorized_access'));            }        }        if (!$type)            $type='[^-]+';        config::$path=ROOT . '/config/config_'.lang::getisadmin().'.php';        $source=file_get_contents(config::$path);        $tpl_str='';        foreach (front::$view->default_tpl_list() as $tpl){            if (!preg_match('/user/',$tpl) && !preg_match('/wap/',$tpl) && !preg_match('/shop/',$tpl)                && !preg_match('/admin/',$tpl) &&!preg_match('/\./',$tpl)){                $tpl_str.="$tpl/$tpl/";            }        }        $tpl_str=rtrim($tpl_str,'/');        $source=str_replace('[默认default]',"=>$tpl_str",$source);        preg_match_all("%//$type-(\S+?)\{(.+?)//\}%s",$source,$result,PREG_PATTERN_ORDER);        $this->view->units=$result[1];        $this->view->tagname=front::get('tagname');  //在线模板跳转回来  增加tagname  然后页面判断打开选中        //var_dump($result);exit;        foreach ($result[2] as $order=>$source2) {            preg_match_all('%\'(\w+)\'=>\'(.*?)\',\s*//([^=\n\[]+)(\[(.+)\])?((.+))?(=>(.+))?%',$source2,$result2,PREG_SET_ORDER);           // echo  "<br/><br/><br/><br/><br/><br/>".print_r($result2);            foreach ($result2 as $key=>$res) {//不是默认语言包的时候 过滤掉特定字段                if(lang::getisadmin()!=lang::getisdefault()){                    //要过滤的特定字段                    $arr = array('stop_site','isdebug','custom404','nav_top','shield_right_key','nav_blank','template_view','lang_type',                        'lang_admin_type','safe360_enable','session_ip','ipcheck_enable','admin_nologin','loginfalsetime','cookie_password',                        'group_on','group_count','isautobak','template_admin_dir','ditu_APK','send_type','header_var',                        'kill_error','smtp_mail_host','smtp_mail_port','smtp_mail_auth','smtp_user_add','smtp_mail_username','smtp_mail_password',                        'smtp_host','smtp_port','sms_username','sms_password','sms_on','sms_keyword','sms_maxnum','sms_reg_on','sms_guestbook_on',                        'sms_order_on','sms_form_on','sms_guestbook_admin_on','sms_form_admin_on','sms_order_admin_on','sms_consult_admin_on',                        'mobilechk_enable','mobilechk_admin','mobilechk_reg','mobilechk_login','mobilechk_buy','mobilechk_form','mobilechk_comment','oss_accessKey','oss_secretKey','oss_domain','oss_bucket','oss_setting',                        'install_admin','stop_site','pc_style_color','mobilechk_guestbook','gee_id','gee_key','xiongzhang_appid','xiongzhang_token','isecoding','admin_dir','list_index_php','site_icp','site_beian','site_beian_number','saic_pic','list_cache');                        if(in_array($res[1], $arr,true)){                                continue;                        }                }                $item=array();                $item['name']=$res[1];                $item['value']=$res[2];                $item['title']=$res[3];                $item['title']=$res[3];                if (isset($res[5])){                    $preg = "/^http(s)?:\\/\\/.+/";                    if(!preg_match($preg,$_SERVER['SERVER_NAME']))                    {                        $serurlname='http://'.$_SERVER['SERVER_NAME'];                    }else{                        $serurlname=$_SERVER['SERVER_NAME'];                    }                    $res[5]=str_replace("{SERVER_NAME}",$serurlname,$res[5]); ;                    $item['intro']=$res[5];                }                //截取  是否单选                $setdata=explode("=>",$res[7]);                if($setdata[0]=="radio"){                    $item['radio'] = true;                }                $res[7]=$setdata[1];                if (isset($res[7]) &&!strstr($res[7],"image") && !strstr($res[7],"color") ) {                    if (strstr($res[7],'$mF')){                        $arr = array_combine(config::getadmin('$mF'),config::getadmin('$mF'));                        $item['select'] = $arr;                    }else{                        $item['select']=url::toarray($res[7]);                    }                }elseif (isset($res[7]) && strstr($res[7],"image")) {                    $item['image']=true;                }elseif (isset($res[7]) && strstr($res[7],"color")) {                    $item['color']=true;                }                $this->view->items[$order][]=$item;            }        }        //后台模板		foreach (front::$view->admin_tpl_list() as $tpl){			if (preg_match('/admin/',$tpl) && !preg_match('/\./',$tpl)){				$admin_str.="$tpl@";			}		}		$admin_str = rtrim($admin_str,"@");		$tmp = explode('@',$admin_str);		$this->view->admintpllist = array_combine($tmp,$tmp);        //会员中心模板        foreach (front::$view->default_tpl_list() as $tpl){            if (preg_match('/user/',$tpl) && !preg_match('/\./',$tpl)){                $user_str.="$tpl@";            }        }        $user_str = rtrim($user_str,"@");        $tmp = explode('@',$user_str);        $this->view->usertpllist = array_combine($tmp,$tmp);        foreach (front::$view->default_tpl_list() as $tpl){            if (preg_match('/member/',$tpl) && !preg_match('/\./',$tpl)){                $member_str.="$tpl@";            }        }        $member_str = rtrim($member_str,"@");        $tmp = explode('@',$member_str);        $this->view->membertpllist = array_combine($tmp,$tmp);        //手机模板        foreach (front::$view->default_tpl_list() as $tpl){            if (preg_match('/wap/',$tpl) && !preg_match('/\./',$tpl)){                $mobile_str.="$tpl@";            }        }        $mobile_str = rtrim($mobile_str,"@");        $tmp = explode('@',$mobile_str);        $this->view->mobiletpllist = array_combine($tmp,$tmp);        //商城模板        foreach (front::$view->default_tpl_list() as $tpl){            if (preg_match('/shop/',$tpl) && !preg_match('/\./',$tpl)){                $shoppingmodelist_str.="$tpl@";            }        }        $shoppingmodelist_str = rtrim($shoppingmodelist_str,"@");        $tmp = explode('@',$shoppingmodelist_str);        $this->view->shoppingmodelist = array_combine($tmp,$tmp);        //是否存在可视化目录        $this->view->isvisual=file_exists(ROOT."/template/".config::get('template_dir')."/visual");        //var_dump($isvisual);        if (front::post('submit')) {            //内容 切换到静态的时候  是否删除静态文件            $oldshow_page_php=config::getadmin("show_page_php");            $oldlist_index_php=config::getadmin("list_index_php");            if ($oldshow_page_php==1 && array_key_exists('show_page_php',front::$post) && front::post('list_index_php')!=1){                cache_admin::delete_make_show_action();            }            //栏目  切换到静态的时候  是否删除静态文件            $oldlist_page_php=config::getadmin("list_page_php");            if ($oldlist_page_php==1 && array_key_exists('list_page_php',front::$post) && front::post('list_page_php')!=1){                cache_admin::delete_make_list_action();            }            //分类  切换到静态的时候  是否删除静态文件            $oldlist_type_php=config::getadmin("list_type_php");            if ($oldlist_type_php==1 && array_key_exists('list_type_php',front::$post) && front::post('list_type_php')!=1){                cache_admin::delete_make_type_action();            }            //Tag  切换到静态的时候  是否删除静态文件            $oldtag_html=config::getadmin("tag_html");            if ($oldtag_html==1 && array_key_exists('tag_html',front::$post) && front::post('tag_html')!=1){                cache_admin::delete_make_tag_action();            }            //专题  切换到静态的时候  是否删除静态文件            $oldlist_special_php=config::getadmin("list_special_php");            if ($oldtag_html==1 && array_key_exists('list_special_php',front::$post) && front::post('list_special_php')!=1){                cache_admin::delete_make_special_action();            }            //手机内容 切换到静态的时候  是否删除静态文件            $oldwap_show_page_php=config::getadmin("wap_show_page_php");            $oldwap_index_php=config::getadmin("wap_index_php");            if ($oldshow_page_php==1 && array_key_exists('wap_show_page_php',front::$post) && front::post('wap_show_page_php')!=1){                wapcache_admin::delete_make_show_action();                front::$admin = true;            }            //手机栏目  切换到静态的时候  是否删除静态文件            $oldlwap_list_page_php=config::getadmin("wap_list_page_php");            if ($oldlwap_list_page_php==1 && array_key_exists('wap_list_page_php',front::$post) && front::post('wap_list_page_php')!=1){                wapcache_admin::delete_make_list_action();                front::$admin = true;            }            //手机分类  切换到静态的时候  是否删除静态文件            $oldwap_type_php=config::getadmin("wap_type_php");            if ($oldwap_type_php==1 && array_key_exists('wap_type_php',front::$post) && front::post('wap_type_php')!=1){                wapcache_admin::delete_make_type_action();                front::$admin = true;            }            //手机Tag  切换到静态的时候  是否删除静态文件            $oldwap_tag_html=config::getadmin("wap_tag_html");            if ($oldwap_tag_html==1 && array_key_exists('wap_tag_html',front::$post) && front::post('wap_tag_html')!=1){                wapcache_admin::delete_make_tag_action();                front::$admin = true;            }            //手机专题  切换到静态的时候  是否删除静态文件            $oldwap_special_php=config::getadmin("wap_special_php");            if ($oldwap_special_php==1 && array_key_exists('wap_special_php',front::$post) && front::post('wap_special_php')!=1){                wapcache_admin::delete_make_special_action();                front::$admin = true;            }            if (front::post('list_page_php')!="" && front::post('show_page_php')!=""){                front::remove(ROOT.'/cache/data/'.lang::getisadmin());            }        	chkpw('system_'.front::$get['set']);        	if (is_array(front::$post)){        		foreach (front::$post as $key=>$value) {        			if(is_array($value)){        				foreach ($value as $v) {        					if(false !== strstr($v,'\\')){        						alerterror(lang_admin('illegal_character'));        					}        				}        			}else if(false !== strstr($value,'\\')){	        			alerterror(lang_admin('illegal_character'));	        		}        		}        		//exit;       		}            if(preg_match('/(php|asp|aspx|jsp|exe|dll|so|asa)/is',front::$post['upload_filetype'])){                alerterror(lang_admin('setting_risk_type_file_upload_is_not_allowed'));            }            if (front::post('admin_dir') &&front::post('admin_dir') != config::getadmin('admin_dir')) {                $new_dir=ROOT.'/'.front::post('admin_dir');                if (ADMIN_DIRNAME != $new_dir) {                    rename(ADMIN_DIRNAME,$new_dir);                    if (is_dir($new_dir)) {                        front::flash(lang_admin('lang_background').lang_admin('catalog').lang_admin('lang_change').'！&nbsp;&nbsp;');                    }                    else                        unset(front::$post['admin_dir']);                }            }            $this->setRewriteFile(front::$post['urlrewrite_on']);			config::modify(front::$post);            if(front::post('cnzz_user') && front::post('cnzz_pass')){            	$content = "user:".config::getadmin('cnzz_user')."\tpass:".config::getadmin('cnzz_pass')."\tdate:".date('Y-m-d H:i:s')."\n";            	$file = ROOT.'/data/cnzz.txt';            	$fp = fopen($file,'ab');            	fwrite($fp,$content);            }            //首页设置动态 自动删除根目录index.html            if(front::post('list_index_php')!=1  && array_key_exists('list_index_php',front::$post) ){                    if(file_exists(ROOT.'/index.html')){                        unlink(ROOT.'/index.html');                    }                    //删除全部语言                    $langdata=getlang();                    if($langdata != "") {                        foreach ($langdata as $key => $val) {                             if(file_exists(ROOT.'/index-'. $val['langurlname'].'.html')){                                 unlink(ROOT.'/index-'. $val['langurlname'].'.html');                             }                        }                    }            }            //修改ueditor_open 配置            if (array_key_exists('ueditor_open',front::$post)){                if (front::post('ueditor_open')==0){                    $ueditor_data = file_get_contents(ROOT . '/ueditor/ueditor.config.js');                    $ueditor_data = str_replace(",allowDivTransToP:true",",allowDivTransToP:false",$ueditor_data);                    $ueditor_data = str_replace("//,allowDivTransToP:true ",",allowDivTransToP:false",$ueditor_data);                    file_put_contents(ROOT . '/ueditor/ueditor.config.js', $ueditor_data);                }else{                    $ueditor_data = file_get_contents(ROOT . '/ueditor/ueditor.config.js');                    $ueditor_data = str_replace(",allowDivTransToP:false",",allowDivTransToP:true",$ueditor_data);                    file_put_contents(ROOT . '/ueditor/ueditor.config.js', $ueditor_data);                }            }            event::log(lang_admin('modify').lang_admin('website_configuration'),lang_admin('success'));            config::modify(front::$post);            front::flash(lang_admin('set_up').lang_admin('success'));            $oldurl=uri();//当前地址            //返回静态生成            if(array_key_exists('list_index_php',front::$post) && (front::post('list_index_php')==1  && $oldlist_index_php!=front::post('list_index_php')) ){                $new_url=url("cache/make_index/config_cache/1");                front::adminconfirm(lang_admin("is_static_html"),$new_url,$oldurl);            }            else if(array_key_exists('show_page_php',front::$post) && ( $oldshow_page_php!=front::post('show_page_php') && front::post('show_page_php')==1)){                $new_url=url("cache/make_show/config_cache/1");                front::adminconfirm(lang_admin("is_static_html"),$new_url,$oldurl);            }            else if(array_key_exists('list_page_php',front::$post) && $oldlist_page_php!=front::post('list_page_php') && (front::post('list_page_php')==1)){                $new_url=url("cache/make_list/config_cache/1");                front::adminconfirm(lang_admin("is_static_html"),$new_url,$oldurl);            }            else if(array_key_exists('list_type_php',front::$post) && $oldlist_type_php!=front::post('list_type_php')  && (front::post('list_type_php')==1)){                $new_url=url("cache/make_type/config_cache/1");                front::adminconfirm(lang_admin("is_static_html"),$new_url,$oldurl);            }            else if(array_key_exists('list_special_php',front::$post) && $oldlist_special_php!=front::post('list_special_php') && (front::post('list_special_php')==1)){                $new_url=url("cache/make_special/config_cache/1");                front::adminconfirm(lang_admin("is_static_html"),$new_url,$oldurl);            }            else if(array_key_exists('tag_html',front::$post)  && $oldtag_html!=front::post('tag_html') && (front::post('tag_html')==1)){                $new_url=url("cache/make_tag/config_cache/1");                front::adminconfirm(lang_admin("is_static_html"),$new_url,$oldurl);            }            //手机返回静态生成            if(array_key_exists('wap_index_php',front::$post) && (front::post('wap_index_php')==1  && $oldwap_index_php!=front::post('wap_index_php')) ){                $new_url=url("wapcache/make_index/wap_config_cache/1");                front::adminconfirm(lang_admin("is_static_html"),$new_url,$oldurl);            }            else if(array_key_exists('wap_show_page_php',front::$post) && ( $oldwap_show_page_php!=front::post('wap_show_page_php') && front::post('wap_show_page_php')==1)){                $new_url=url("wapcache/make_show/wap_config_cache/1");                front::adminconfirm(lang_admin("is_static_html"),$new_url,$oldurl);            }            else if(array_key_exists('wap_list_page_php',front::$post) && $oldlwap_list_page_php!=front::post('wap_list_page_php') && (front::post('wap_list_page_php')==1)){                $new_url=url("wapcache/make_list/wap_config_cache/1");                front::adminconfirm(lang_admin("is_static_html"),$new_url,$oldurl);            }            else if(array_key_exists('wap_type_php',front::$post) && $oldwap_type_php!=front::post('wap_type_php')  && (front::post('wap_type_php')==1)){                $new_url=url("wapcache/make_type/wap_config_cache/1");                front::adminconfirm(lang_admin("is_static_html"),$new_url,$oldurl);            }            else if(array_key_exists('wap_special_php',front::$post) && $oldwap_special_php!=front::post('wap_special_php') && (front::post('wap_special_php')==1)){                $new_url=url("wapcache/make_special/wap_config_cache/1");                front::adminconfirm(lang_admin("is_static_html"),$new_url,$oldurl);            }            else if(array_key_exists('wap_tag_html',front::$post)  && $oldwap_tag_html!=front::post('wap_tag_html') && (front::post('wap_tag_html')==1)){                $new_url=url("wapcache/make_tag/wap_config_cache/1");                front::adminconfirm(lang_admin("is_static_html"),$new_url,$oldurl);            }            if (!empty($new_dir) || !front::post('submit')) {                front::$view->sysVar();                $new_url=front::$view->admin_url;                front::redirect($new_url);            }else if(front::get('set')=='template'){                $new_url=modify('act/system/set/template');                front::redirect($new_url);            }else if(front::get('set')=='sms'){                $new_url=url('config/system/set/sms');                front::redirect($new_url);            }        }    }    private function setRewriteFile($urlrewrite_on)    {        //$_SERVER['SERVER_SOFTWARE'] = 'IIS6';        //var_dump($_SERVER['SERVER_SOFTWARE']);        //exit;        $base = config::getadmin('base_url');        if ($urlrewrite_on) {            if (stristr($_SERVER['SERVER_SOFTWARE'], 'Apache') || stristr($_SERVER['SERVER_SOFTWARE'], 'IIS6')) {                $htaccess = 'RewriteEngine on' . "\n";                //$htaccess.= 'RewriteBase '.$base."\n";                $htaccess .= 'RewriteCond %{REQUEST_FILENAME} !-d' . "\n";                $htaccess .= 'RewriteCond %{REQUEST_FILENAME} !-f' . "\n";                $htaccess .= 'RewriteRule !\.(mp3|mp4|wmv|wma|rm|rmvb|js|ico|gif|jpeg|jpg|png|css|swf|php|html|shtml|xml|xsl|wsdl|xslt|eot|svg|ttf|woff|woff2|map|txt)$ ' . $base . '/index.php [NC]' . "\n";                $httpdurl = '.htaccess';                $httpd = $htaccess;            } else if (stristr($_SERVER['SERVER_SOFTWARE'], 'IIS/7') || stristr($_SERVER['SERVER_SOFTWARE'], 'IIS/10')) {                $web = '<?xml version="1.0" encoding="UTF-8"?>' . "\n";                $web .= '<configuration>' . "\n";                $web .= '<system.webServer>' . "\n";                $web .= '<rewrite>' . "\n";                $web .= '<rules>' . "\n";                $web .= '<rule name="CmsEasy Url Rewrite">' . "\n";                $web .= '<match url="\.(mp3|mp4|wmv|wma|rm|rmvb|js|ico|gif|jpeg|jpg|png|css|swf|php|html|shtml|xml|xsl|wsdl|xslt|eot|svg|ttf|woff|woff2|map|txt)$" negate="true" />' . "\n";                $web .= '<conditions logicalGrouping="MatchAll">' . "\n";                $web .= '<add input="{REQUEST_FILENAME}" matchType="IsDirectory" ignoreCase="false" negate="true" />' . "\n";                $web .= '<add input="{REQUEST_FILENAME}" matchType="IsFile" ignoreCase="false" negate="true" />' . "\n";                $web .= '</conditions>' . "\n";                $web .= '<action type="Rewrite" url="index.php" />' . "\n";                $web .= '</rule>' . "\n";                $web .= '</rules>' . "\n";				$web.= '</rewrite>'."\n";                $web.= '<httpErrors errorMode="Custom">'."\n";                $web.= '<remove statusCode="404" subStatusCode="-1" />'."\n";                $web.= '<error statusCode="404" prefixLanguageFilePath="" path="/404.php" responseMode="ExecuteURL" />'."\n";                $web.= '</httpErrors>'."\n";                $web .= '</system.webServer>' . "\n";                $web .= '</configuration>' . "\n";                $httpdurl = 'web.config';                $httpd = $web;            } else if (stristr($_SERVER['SERVER_SOFTWARE'], 'nginx')) {                $htaccess = 'if ($request_filename !~* \.(mp3|mp4|wmv|wma|rm|rmvb|js|ico|gif|jpeg|jpg|png|css|swf|php|html|shtml|xml|xsl|wsdl|xslt|eot|svg|ttf|woff|woff2|map|txt$)) {' . "\n";                $htaccess .= 'rewrite .* ' . $base . '/index.php last;' . "\n";                $htaccess .= '}' . "\n";                $httpdurl = '.htaccess';                $httpd = $htaccess;            } else {                $httpd = '[ISAPI_Rewrite]' . "\n";                $httpd .= '# 3600 = 1 hour' . "\n";                $httpd .= 'CacheClockRate 3600' . "\n";                $httpd .= 'RepeatLimit 32' . "\n";                $httpd .= 'RewriteRule !\.(mp3|mp4|wmv|wma|rm|rmvb|js|ico|gif|jpeg|jpg|png|css|swf|php|html|shtml|xml|xsl|wsdl|xslt|eot|svg|ttf|woff|woff2|map|txt)$ ' . $base . '/index.php [L]' . "\n";                $httpdurl = 'httpd.ini';            }            if (!file_exists(ROOT . '/' . $httpdurl)){                $fp = fopen(ROOT . '/' . $httpdurl, 'w');                fputs($fp, $httpd);                fclose($fp);            }        } else {            if(config::getadmin('autoDelRewriteFile')){                @unlink(ROOT . '/httpd.ini');                @unlink(ROOT . '/.htaccess');                @unlink(ROOT . '/web.config');            }            /*if (file_exists(ROOT . '/httpd.ini')) @unlink(ROOT . '/httpd.ini');            if (file_exists(ROOT . '/.htaccess')) @unlink(ROOT . '/.htaccess');            if (file_exists(ROOT . '/web.config')) @unlink(ROOT . '/web.config');*/        }        //exit;    }    function _url($action = 'getmoinf') {        form_admin::init();        $this->__table=new defind($this->table);        $pars=array(                'action'=>$action,                'tel'=>config::getadmin('tel'),                'sitename'=>config::getadmin('sitename'),                'site_url'=>config::getadmin('site_url'),                'encoding'=>'utf-8',                'host'=>$_SERVER['HTTP_HOST'],                'version'=>'cmseasy3.0',                'release'=>config::getadmin('version'),                'os'=>PHP_OS,                'php'=>phpversion(),                'mysql'=>$this->__table->verison(),                'browser'=>urlencode($_SERVER['HTTP_USER_AGENT']),                'address'=>config::getadmin('address'),                'email'=>config::getadmin('email'),                'serverip'=>$_SERVER['REMOTE_ADDR'],                'serverfilename'=>urlencode($_SERVER['SCRIPT_FILENAME']),        );        $data=http_build_query($pars);        $verify=md5($data.config::getadmin('email'));        return 'http://info.cmseasy.cn/server/upgrade.php?'.$data.'&verify='.$verify;    }	function config_info() {      //return '<script type="text/javascript" src="'.$this->_url('getmoinf').'"></script>';    }    function remove_action() {    	chkpw('cache_update');        front::remove(ROOT.'/cache/data');        front::remove(ROOT.'/cache/template');        front::remove(ROOT.'/cache/downloads');        front::remove(ROOT.'/lang/config/lang_all.php');        user::deletesession();        category::deletesession();        type::deletesession();        special::deletesession();        $user=new user();        $user->close_db();        cookie::del('passinfo');        front::flash(lang_admin('cache').lang_admin('update').lang_admin('success'));        front::redirect(url('index',true));    }    function sms_action() {    }    function hottag_action(){    	$set=settings::getInstance();    	if(front::post('submit')){    		$var=front::$post;            unset($var['submit']);            $set->rec_replace(array('value' => addslashes(serialize($var)), 'tag' => 'table-hottag', 'array' => addslashes(var_export($var, true))));            event::log(lang_admin('tags').lang_admin('modify'),lang_admin('success'));            front::flash(lang_admin('tags').lang_admin('modify').lang_admin('success'));        }        $sets=$set->getrow(array('tag'=>'table-hottag'));        if(empty($sets)){        	$set->rec_insert(array('tag'=>'table-hottag'));        	$sets=$set->getrow(array('tag'=>'table-hottag'));        }        if(empty($sets['value']))           $this->view->hottags = NULL;        else           $this->view->hottags =  unserialize($sets['value']);    }    function index_action(){    }    //打开多点地图    function atlas_action(){        if(session::get('ver') != 'corp'){            front::alert(lang_admin('unauthorized_access'));        }        $atlasmap=new atlasmap();        $atlasmaplist = $atlasmap->getrows('', 0,'id desc ');        $this->view->data =$atlasmaplist;        $this->view->atlasmaplist = json_encode($atlasmaplist);    }    //地图插入节点    function saveatlas_action(){        $returndata=array();        $atlasmap=new atlasmap();        $insert = $atlasmap->rec_insert(front::$post);        if ($insert < 1) {            $returndata['message']= lang_admin('add_to').lang_admin('failure');        }        else {            $returndata['message']= lang_admin('add_to').lang_admin('success');        }        $atlasmaplist = $atlasmap->getrows('', 1,'id desc ');        if(is_array($atlasmaplist)){            $returndata['atlas']=$atlasmaplist[0];        }        echo  json_encode($returndata);       exit;    }    //删除地图节点    function deletemap_action(){        $atlasmap=new atlasmap();        $delete = $atlasmap->rec_delete(front::get('id'));        if ($delete) {            front::flash(lang_admin('successful_deletion'));        }else{            front::flash(lang_admin('delete').lang_admin('failure'));        }        front::redirect(url('config/atlas'));    }    //编辑节点    function editmap_action(){        $atlasmap=new atlasmap();        $update =$atlasmap->rec_update(front::$post, front::get('id'));        if ($update) {            front::flash(lang_admin('save_successfully'));        }else{            front::flash(lang_admin('save_failed'));        }        front::redirect(url('config/atlas'));    }    function end() {        $this->render();        //echo $this->config_info();    }}